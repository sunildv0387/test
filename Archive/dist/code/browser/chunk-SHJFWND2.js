import{$ as y,A as C,C as O,Ca as K,D as l,E,H as f,I as c,J as H,M as L,N as r,O as n,P as d,S,T as x,U as p,Ua as q,V as A,Va as G,W as R,X as j,Y as D,_ as a,a as I,aa as w,b as T,ca as V,ha as z,ja as M,ma as N,na as U,oa as W,pa as B,r as F,ra as k,sa as X,u as v,v as _,ya as Q,z as $,za as J}from"./chunk-7QXYFICR.js";var te=["carousel"],ie=(s,m)=>["/category",s,m],re=(s,m)=>({"bg-wattpad-primary text-white":s,"bg-white text-wattpad-primary border border-wattpad-primary":m});function ne(s,m){s&1&&d(0,"i",39)}function oe(s,m){s&1&&d(0,"i",40)}function se(s,m){if(s&1){let e=S();r(0,"div",27)(1,"div",28)(2,"div",29),x("click",function(){let i=v(e).$implicit,o=p();return _(o.goToSeries(i.id,i.story_title))}),d(3,"img",30),n(),r(4,"button",31),x("click",function(){let i=v(e).$implicit,o=p();return _(o.addToLibrary(i.id))}),f(5,ne,1,0,"i",32)(6,oe,1,0,"i",33),n()(),d(7,"h3",34),r(8,"p",35),a(9,"Emily R."),n(),r(10,"div",36),d(11,"i",37),r(12,"span"),a(13,"4.8"),n(),r(14,"span",38),a(15,"\u2022"),n(),r(16,"span"),a(17),n()()()}if(s&2){let e=m.$implicit,t=p();l(3),A("alt",e.story_title),c("src",t.storyImgPath+"/"+e.story_image,C),l(),c("title",t.likedStories.includes(e.id)?"Remove from Library":"Add to Library"),l(),c("ngIf",t.likedStories.includes(e.id)),l(),c("ngIf",!t.likedStories.includes(e.id)),l(),c("innerHTML",e.story_title,$),l(10),w("",t.formatCount(e.views)," reads")}}function ae(s,m){if(s&1&&(r(0,"a",41)(1,"div",42),d(2,"i"),n(),r(3,"span",43),a(4),n()()),s&2){let e=m.$implicit;c("routerLink",M(5,ie,e.id,e.categoryName.toLowerCase().replace(" ","-"))),l(2),L("fas ",e.icon,""),l(2),y(e.categoryName)}}function le(s,m){if(s&1){let e=S();r(0,"div",44)(1,"div",45)(2,"div",46)(3,"span",47),a(4),n()(),r(5,"h3",48),a(6),n(),r(7,"p",35),a(8),n(),r(9,"button",49),x("click",function(){let i=v(e).$implicit,o=p();return _(o.toggleFollow(i.user_id))}),a(10),n()()()}if(s&2){let e=m.$implicit,t=p();l(4),y(e.author_name.charAt(0)),l(2),y(e.author_name),l(2),w("",e.story_count," Stories"),l(),c("ngClass",M(5,re,!t.isFollowingMap[e.user_id],t.isFollowingMap[e.user_id])),l(),w(" ",t.isFollowingMap[e.user_id]?"Unfollow":"Follow",`
`)}}function de(s,m){if(s&1&&d(0,"img",60),s&2){let e=p(2);c("src",e.userProgress[0].image,C)}}function ce(s,m){if(s&1){let e=S();r(0,"div")(1,"div",50),x("click",function(){v(e);let i=p();return _(i.resumeReading(i.userProgress[0].lastReadPartId,i.userProgress[0].title))}),r(2,"div",51)(3,"div",52),f(4,de,1,1,"img",53),n(),r(5,"div",54)(6,"h3",48),a(7),n(),r(8,"p",55),a(9),n(),r(10,"div",56),d(11,"div",57),n()(),r(12,"button",58),x("click",function(i){v(e);let o=p();return o.resumeReading(o.userProgress[0].lastReadPartId,o.userProgress[0].title),_(i.stopPropagation())}),d(13,"i",59),n()()()()}if(s&2){let e=p();l(4),c("ngIf",e.userProgress[0].image),l(3),y(e.userProgress[0].title),l(2),V(" Read: ",e.userProgress[0].part," of ",e.userProgress[0].total," - ",e.userProgress[0].title," "),l(2),H("width",e.userProgress[0].percent+"%")}}function me(s,m){if(s&1&&d(0,"img",70),s&2){let e=p().$implicit,t=p();c("src",t.storyImgPath+"/"+e.story_image,C)}}function pe(s,m){if(s&1){let e=S();r(0,"div",61),x("click",function(){let i=v(e).$implicit,o=p();return _(o.goToSeries(i.id,i.story_title))}),r(1,"div",62)(2,"div",63),f(3,me,1,1,"img",64),n(),r(4,"div")(5,"h3",65),a(6),n(),r(7,"p",66),a(8),n(),r(9,"div",67)(10,"span"),a(11),n()(),r(12,"p",68),a(13),n(),r(14,"button",69),a(15," Read Now "),n()()()()}if(s&2){let e=m.$implicit,t=p();l(3),c("ngIf",e.story_image),l(3),y(e.story_title),l(2),w("By ",e.author_name,""),l(3),w("",t.formatCount(e.views||1200)," Views"),l(2),y(e.description||"No description available")}}var be=(()=>{class s{constructor(e,t,i){this.allApi=e,this.http=t,this.router=i,this.stories=[],this.libraryMessage="",this.categoryColumns=[],this.likedStories=[],this.userId=null,this.storyImgPath="https://hyperblah.com/funtelapi",this.userProgress=[],this.topAuthors=[],this.isFollowingMap={},this.latestStories=[],this.currentSlideIndex=0,this.slideWidth=0,this.isDragging=!1,this.startPos=0,this.currentTranslate=0,this.prevTranslate=0}ngAfterViewInit(){this.calculateSlideWidth(),this.setupCarousel()}onResize(){this.calculateSlideWidth()}calculateSlideWidth(){this.carousel?.nativeElement?.firstElementChild&&(this.slideWidth=this.carousel.nativeElement.firstElementChild.clientWidth)}setupCarousel(){let e=this.carousel.nativeElement;e.addEventListener("mousedown",t=>this.startDrag(t)),e.addEventListener("mouseleave",()=>this.endDrag()),e.addEventListener("mouseup",()=>this.endDrag()),e.addEventListener("mousemove",t=>this.dragMove(t)),e.addEventListener("touchstart",t=>this.startDrag(t)),e.addEventListener("touchend",()=>this.endDrag()),e.addEventListener("touchmove",t=>this.dragMove(t))}startDrag(e){this.isDragging=!0,this.startPos=this.getPositionX(e),this.carousel.nativeElement.style.cursor="grabbing"}endDrag(){this.isDragging=!1,this.carousel.nativeElement.style.cursor="grab"}dragMove(e){if(!this.isDragging)return;e.preventDefault();let t=this.getPositionX(e);this.currentTranslate=this.prevTranslate+t-this.startPos,this.carousel.nativeElement.style.transform=`translateX(${this.currentTranslate}px)`}getPositionX(e){return e.type.includes("mouse")?e.pageX:e.touches[0].clientX}scrollCarousel(e){this.currentSlideIndex=Math.max(0,Math.min(this.currentSlideIndex+e,this.latestStories.length-1));let t=this.currentSlideIndex*this.slideWidth;this.carousel.nativeElement.scrollTo({left:t,behavior:"smooth"})}getProgress(e){let t=this.userProgress.find(i=>i.storyId==e);return t?t.percent:0}ngOnInit(){this.getAllStories(),this.getCategory(),this.loadLikedStories(),this.loadUserStoryProgress()}getAllStories(){this.http.get("https://hyperblah.com/funtelapi/allstory.php").subscribe(e=>{if(e.status==="success"){let t=e.data.sort((i,o)=>new Date(o.created_at).getTime()-new Date(i.created_at).getTime());this.latestStories=t.slice(0,2).map(i=>T(I({},i),{views:+i.views||0})),this.stories=e.data.map(i=>T(I({},i),{views:+i.views||0})),this.calculateTopAuthors(e.data),this.loadFollowStatus()}else console.error("Error fetching stories:",e.message)},e=>{console.error("API call failed:",e)})}calculateTopAuthors(e){let t={};for(let o of e){let g=o.user_id,h=+o.views||0;t[g]?(t[g].views+=h,t[g].story_count+=1):t[g]={user_id:g,author_name:o.author_name||"Unknown",views:h,story_count:1}}let i=Object.values(t);this.topAuthors=i.sort((o,g)=>g.views-o.views).slice(0,10)}goToSeries(e,t){let i=this.slugify(t);this.router.navigate(["/story",`${e}-${i}`])}slugify(e){return e.toLowerCase().trim().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")}getCategory(){let e=new k({"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("token")}`});this.http.get("https://hyperblah.com/funtelapi/category.php",{headers:e,withCredentials:!0}).subscribe({next:t=>{t.status==="success"&&(this.categoryColumns=t.data.flat(),console.log("categoryColumnssss",this.categoryColumns))},error:t=>{console.error("Failed to fetch categories:",t)}})}addToLibrary(e){let t=sessionStorage.getItem("userId");if(!t)return;let i={user_id:t,story_id:e,like_story:!0};this.http.post("https://hyperblah.com/funtelapi/addstory.php",i).subscribe({next:o=>{o.status==="success"?(this.likedStories.push(e),this.libraryMessage="Story added to library"):o.status==="removed"&&(this.likedStories=this.likedStories.filter(g=>g!==e),this.libraryMessage="Story removed from library"),setTimeout(()=>this.libraryMessage="",3e3)},error:()=>{console.error("Library action failed")}})}loadLikedStories(){let e=sessionStorage.getItem("userId");e&&this.http.get(`https://hyperblah.com/funtelapi/allstory.php?action=library&user_id=${e}`).subscribe({next:t=>{t.status==="success"&&(this.likedStories=t.data.map(i=>+i.id),console.log("Liked Stories:",this.likedStories))},error:t=>{console.error("Failed to load liked stories:",t)}})}getTotalReadingTime(){return this.stories.reduce((e,t)=>e+(t.readTime||0),0)}formatTotalReadTime(e){if(e>=10080){let t=Math.floor(e/10080),i=e%10080;return`${t} week${t>1?"s":""}`+(i>0?` ${this.formatTotalReadTime(i)}`:"")}else if(e>=1440){let t=Math.floor(e/1440),i=e%1440;return`${t} day${t>1?"s":""}`+(i>0?` ${this.formatTotalReadTime(i)}`:"")}else if(e>=60){let t=Math.floor(e/60),i=e%60;return`${t} hr${t>1?"s":""}`+(i>0?` ${i} min`:"")}else return`${e} min`}getTotalViews(){return this.stories.reduce((e,t)=>e+(t.views||0),0)}formatCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}resumeReading(e,t){let i=t.toLowerCase().replace(/\s+/g,"-");this.router.navigate(["/series",`${e}-${i}`])}loadUserStoryProgress(){let t=`story_progress_${sessionStorage.getItem("userId")}`,i=localStorage.getItem(t);if(i){let o=JSON.parse(i),g=Object.entries(o);this.userProgress=[];for(let[h,u]of Object.entries(o)){let Y=Math.round(u.readParts.length/u.totalParts*100);this.http.get(`https://hyperblah.com/funtelapi/allstory.php?id=${h}`).subscribe({next:b=>{if(b.status==="success"&&b.data?.length){let Z=b.data.find(P=>P.id==+h);this.userProgress.push({storyId:h,title:u.lastPartTitle,lastReadPartId:u.lastReadPartId,percent:Y,part:u.readParts.length,total:u.totalParts,timestamp:u.timestamp,image:`https://hyperblah.com/funtelapi/${Z.story_image}`}),console.log("userProgress",this.userProgress),this.userProgress.sort((P,ee)=>ee.timestamp-P.timestamp)}},error:b=>{console.error(`Failed to fetch story info for storyId ${h}`,b)}})}}}toggleFollow(e){let t=sessionStorage.getItem("userId");if(!t||t===e)return;let i=this.isFollowingMap[e],o=i?"https://hyperblah.com/funtelapi/follow/unfollow.php":"https://hyperblah.com/funtelapi/follow/follow.php",g={follower_id:+t,following_id:+e},h=new k({"Content-Type":"application/json"});this.http.post(o,g,{headers:h,withCredentials:!0}).subscribe({next:u=>{this.isFollowingMap[e]=!i,console.log(`\u2705 ${i?"Unfollowed":"Followed"} author ${e}`)},error:u=>{console.error("\u274C Follow/Unfollow failed:",u)}})}loadFollowStatus(){let e=sessionStorage.getItem("userId");if(e)for(let t of this.topAuthors){let i=new k({"Content-Type":"application/json"});this.http.post("https://hyperblah.com/funtelapi/follow/check_follow.php",{follower_id:+e,following_id:+t.user_id},{headers:i,withCredentials:!0}).subscribe({next:o=>{this.isFollowingMap[t.user_id]=o.isFollowing||!1},error:o=>{console.error(`\u274C Error checking follow for ${t.user_id}:`,o)}})}}static{this.\u0275fac=function(t){return new(t||s)(E(q),E(X),E(Q))}}static{this.\u0275cmp=F({type:s,selectors:[["app-home"]],viewQuery:function(t,i){if(t&1&&R(te,5),t&2){let o;j(o=D())&&(i.carousel=o.first)}},hostBindings:function(t,i){t&1&&x("resize",function(){return i.onResize()},!1,O)},standalone:!0,features:[z],decls:71,vars:5,consts:[[1,"container","mx-auto","px-4","pb-6","lg:px-6","lg:py-8"],[1,"mt-4","mb-8","lg:mb-12"],[1,"carousel","hide-scrollbar","flex","overflow-x-auto","space-x-4","pb-4","lg:space-x-6","lg:pb-6"],[1,"carousel-item","w-full","flex-shrink-0","lg:w-2/3"],[1,"relative","rounded-xl","overflow-hidden","h-48","lg:h-80"],[1,"absolute","inset-0","bg-gradient-to-r","from-black/60","to-transparent","z-10"],[1,"bg-black","h-full","w-full","flex","items-center","justify-center"],["src","banner/banner_1.jpg","alt",""],[1,"absolute","bottom-0","left-0","p-6","z-20","text-white"],[1,"text-sm","font-medium","bg-wattpad-primary","px-2","py-1","rounded"],[1,"text-2xl","lg:text-4xl","font-bold","mt-2"],[1,"text-sm","lg:text-base","mt-1"],[1,"story-progress","w-full","mt-3","rounded"],[1,"story-progress-bar","rounded",2,"width","65%"],["src","banner/luna_1.jpg","alt",""],[1,"story-progress-bar","rounded",2,"width","15%"],[1,"mb-8","lg:mb-12"],[1,"flex","justify-between","items-center","mb-4","lg:mb-6"],[1,"text-xl","lg:text-2xl","font-bold"],["href","#",1,"text-wattpad-primary","text-sm","lg:text-base","font-medium","hover:underline"],["class","carousel-item w-32 flex-shrink-0 lg:w-48",4,"ngFor","ngForOf"],[1,"grid","grid-cols-3","gap-3","lg:grid-cols-6","lg:gap-4"],["class","bg-white dark:bg-gray-800 rounded-lg p-4 text-center hover:shadow-md transition-all hover:-translate-y-1",3,"routerLink",4,"ngFor","ngForOf"],["class","carousel-item flex-shrink-0",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4","lg:gap-6"],["class","pointer bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm hover:shadow-md transition-all",3,"click",4,"ngFor","ngForOf"],[1,"carousel-item","w-32","flex-shrink-0","lg:w-48"],[1,"relative","story-card"],[1,"pointer","bg-gray-200","h-40","lg:h-56","rounded-lg","overflow-hidden","flex","items-center","justify-center","story-cover","transition-transform","duration-300",3,"click"],[3,"src","alt"],[1,"absolute","top-2","right-2","bg-white/90","text-wattpad-primary","p-1","rounded-full","hover:bg-white","transition-colors",3,"click","title"],["class","fas fa-heart text-red-500",4,"ngIf"],["class","far fa-heart text-gray-400",4,"ngIf"],[1,"font-bold","text-sm","lg:text-base","mt-2","truncate",3,"innerHTML"],[1,"text-xs","lg:text-sm","text-wattpad-light"],[1,"flex","items-center","mt-1","text-xs","lg:text-sm","text-wattpad-light"],[1,"fas","fa-star","text-yellow-400","mr-1"],[1,"mx-1"],[1,"fas","fa-heart","text-red-500"],[1,"far","fa-heart","text-gray-400"],[1,"bg-white","dark:bg-gray-800","rounded-lg","p-4","text-center","hover:shadow-md","transition-all","hover:-translate-y-1",3,"routerLink"],[1,"text-wattpad-primary","text-2xl","mb-2"],[1,"font-medium","text-sm","lg:text-base"],[1,"carousel-item","flex-shrink-0"],[1,"bg-white","dark:bg-gray-800","rounded-lg","p-4","text-center","w-32","lg:w-40","shadow","hover:shadow-lg","transition-all","writer-card"],[1,"bg-gray-200","dark:bg-gray-700","h-20","w-20","lg:h-24","lg:w-24","mx-auto","rounded-full","mb-3","flex","items-center","justify-center"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-bold","text-sm","lg:text-base","truncate"],[1,"mt-2","text-xs","lg:text-sm","px-3","py-1","rounded-full","transition-colors",3,"click","ngClass"],[1,"bg-white","dark:bg-gray-800","rounded-xl","p-4","shadow-sm","hover:shadow-md","transition-shadow","pointer",3,"click"],[1,"flex","items-center","space-x-3","lg:space-x-4"],[1,"bg-gray-200","w-16","h-16","lg:w-20","lg:h-20","rounded-lg","flex-shrink-0","flex","items-center","justify-center","overflow-h"],["alt","Story Cover","class","w-full h-full object-cover",3,"src",4,"ngIf"],[1,"flex-1","min-w-0"],[1,"text-xs","lg:text-sm","text-wattpad-light","truncate"],[1,"w-full","bg-gray-200","dark:bg-gray-700","h-1.5","rounded-full","mt-2"],[1,"bg-wattpad-primary","h-1.5","rounded-full"],[1,"text-wattpad-primary","hover:text-[#E5274B]","transition-colors","pointer",3,"click"],[1,"fas","fa-play","text-lg","lg:text-xl"],["alt","Story Cover",1,"w-full","h-full","object-cover",3,"src"],[1,"pointer","bg-white","dark:bg-gray-800","rounded-xl","p-4","shadow-sm","hover:shadow-md","transition-all",3,"click"],[1,"flex","space-x-3","lg:space-x-4"],[1,"bg-gray-200","w-20","h-28","lg:w-24","lg:h-32","rounded-lg","flex-shrink-0","flex","items-center","justify-center"],["alt","Cover","class","w-full h-full object-cover",3,"src",4,"ngIf"],[1,"font-bold","text-sm","lg:text-base"],[1,"text-xs","lg:text-sm","text-wattpad-light","mb-2"],[1,"flex","items-center","text-xs","lg:text-sm","text-wattpad-light","mb-2"],[1,"text-xs","lg:text-sm","line-clamp-2"],[1,"mt-3","text-xs","lg:text-sm","bg-wattpad-primary","text-white","px-3","py-1","rounded-full","hover:bg-[#E5274B]","transition-colors"],["alt","Cover",1,"w-full","h-full","object-cover",3,"src"]],template:function(t,i){t&1&&(d(0,"app-header"),r(1,"main",0)(2,"section",1)(3,"div",2)(4,"div",3)(5,"div",4),d(6,"div",5),r(7,"div",6),d(8,"img",7),n(),r(9,"div",8)(10,"span",9),a(11,"TRENDING"),n(),r(12,"h2",10),a(13,"Kalindi"),n(),r(14,"p",11),a(15,"By Amol. \u2022 45.2k reads \u2022 Updated 2h ago"),n(),r(16,"div",12),d(17,"div",13),n()()()(),r(18,"div",3)(19,"div",4),d(20,"div",5),r(21,"div",6),d(22,"img",14),n(),r(23,"div",8)(24,"span",9),a(25,"NEW RELEASE"),n(),r(26,"h2",10),a(27,"Lona"),n(),r(28,"p",11),a(29,"By Amol. \u2022 32.7k reads \u2022 Just released"),n(),r(30,"div",12),d(31,"div",15),n()()()()()(),r(32,"section",16)(33,"div",17)(34,"h2",18),a(35,"Trending Now"),n(),r(36,"a",19),a(37,"See All"),n()(),r(38,"div",2),f(39,se,18,7,"div",20),n()(),r(40,"section",16)(41,"div",17)(42,"h2",18),a(43,"Categories"),n(),r(44,"a",19),a(45,"See All"),n()(),r(46,"div",21),f(47,ae,5,8,"a",22),n()(),r(48,"section",16)(49,"div",17)(50,"h2",18),a(51,"Top Writers"),n(),r(52,"a",19),a(53,"See All"),n()(),r(54,"div",2),f(55,le,11,8,"div",23),n()(),r(56,"section",16)(57,"div",17)(58,"h2",18),a(59,"Continue Reading"),n(),r(60,"a",19),a(61,"See All"),n()(),f(62,ce,14,7,"div",24),n(),r(63,"section",16)(64,"div",17)(65,"h2",18),a(66,"New Releases"),n(),r(67,"a",19),a(68,"See All"),n()(),r(69,"div",25),f(70,pe,16,5,"div",26),n()()()),t&2&&(l(39),c("ngForOf",i.stories),l(8),c("ngForOf",i.categoryColumns),l(8),c("ngForOf",i.topAuthors),l(7),c("ngIf",i.userProgress.length>0),l(8),c("ngForOf",i.latestStories))},dependencies:[G,B,N,U,W,K,J],styles:[".swiper[_ngcontent-%COMP%]{width:100%;height:auto;position:relative}.swiper-button-next[_ngcontent-%COMP%], .swiper-button-prev[_ngcontent-%COMP%]{color:red;background:#000;padding:20px;border-radius:50%}.swiper-button-next[_ngcontent-%COMP%]:hover, .swiper-button-prev[_ngcontent-%COMP%]:hover{background:#000c}.swiper-pagination[_ngcontent-%COMP%]{bottom:10px}.storiesbox[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px}.storyDetails[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:16px}.storyDetails[_ngcontent-%COMP%]   .graytxt[_ngcontent-%COMP%]{font-size:11px;margin-top:0;padding-top:0}.eyeread[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{font-size:7px}.carousel-container[_ngcontent-%COMP%]{position:relative}.carousel-nav[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);background:#ffffffb3;border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;transition:all .3s ease}.carousel-nav[_ngcontent-%COMP%]:hover{background:#ffffffe6}.carousel-nav[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#333;font-size:1.2rem}"]})}}return s})();export{be as HomeComponent};
