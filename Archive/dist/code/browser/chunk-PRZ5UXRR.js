import{D as a,E as m,H as v,I as g,N as s,O as n,P as u,S as _,T as h,U as d,Va as F,_ as o,aa as l,ha as b,ja as w,ma as I,na as C,oa as E,pa as S,r as y,ra as k,sa as T,u as x,v as f,wa as M,ya as $}from"./chunk-7QXYFICR.js";var j=(r,p)=>({"story-status":!0,"status-published bg-success":r,"status-draft bg-warning":p});function L(r,p){if(r&1&&(s(0,"div",23),o(1),n()),r&2){let t=d().$implicit,e=d();a(),l(" ",e.messageMap[t.id],`
`)}}function N(r,p){if(r&1){let t=_();s(0,"div",9),h("click",function(){let i=x(t).$implicit,c=d();return f(c.goToEdit(i))}),s(1,"div",10)(2,"div",11)(3,"span",12),o(4,"Cover"),n()(),s(5,"div",13)(6,"h3",14),o(7),s(8,"span",15),o(9),n()(),s(10,"div",16),u(11,"i",17),s(12,"span"),o(13,"4.8 (1.2k)"),n()(),s(14,"p",18),o(15,"A detective uncovers dark secrets in a small town where everyone seems to be hiding something."),n(),s(16,"div",19)(17,"span",20),o(18),n(),s(19,"button",21),h("click",function(){let i=x(t).$implicit,c=d();return f(c.goToEdit(i))}),o(20," Edit "),n()()()(),v(21,L,2,1,"div",22),n()}if(r&2){let t=p.$implicit,e=d();a(7),l("",t.story_title," "),a(),g("ngClass",w(5,j,t.status=="1",t.status=="0")),a(),l(" ",t.status=="0"?"Draft":"Published",`
`),a(9),l("Updated: ",t.date,""),a(3),g("ngIf",e.messageMap[t.id])}}var R=(()=>{class r{constructor(t,e,i){this.http=t,this.router=e,this.route=i,this.stories=[],this.isLoading=!0,this.errorMessage="",this.messageMap={},this.storyImgPath="https://hyperblah.com/funtelapi",this.storyId=null}ngOnInit(){if(!sessionStorage.getItem("userId")){this.router.navigate(["login"]);return}let e=this.route.snapshot.paramMap.get("idAndTitle");if(e){let i=e.split("-")[0];this.storyId=Number(i),console.log("storyId",this.storyId)}this.fetchStories()}fetchStories(){let t=sessionStorage.getItem("userId");if(!t){this.errorMessage="Please login to view your stories",this.isLoading=!1,this.router.navigate(["/login"]);return}let e=new k({"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("token")}`});this.http.post(`https://hyperblah.com/funtelapi/draft_get_ep.php?stories_id=${this.storyId}`,{user_id:t},{headers:e}).subscribe({next:i=>{i.status==="success"&&i.data?(this.stories=i.data,console.log("story",this.stories)):this.errorMessage="Story not found.",this.isLoading=!1},error:i=>{console.error("Error fetching story:",i),this.errorMessage="Failed to load story. Please try again later.",this.isLoading=!1}})}goToEdit(t){if(this.messageMap={},t.status==="1"){this.messageMap[t.id]="This story has already been published and cannot be edited.";return}let e=this.slugify(t.story_title),i=t.id;this.router.navigate(["/story-write",`${i}-${e}`])}goToCreate(){if(!this.stories.length)return;let t=this.stories[0].stories_id;this.router.navigate(["/creat",t])}slugify(t){return t.toLowerCase().trim().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")}static{this.\u0275fac=function(e){return new(e||r)(m(T),m($),m(M))}}static{this.\u0275cmp=y({type:r,selectors:[["app-episode"]],standalone:!0,features:[b],decls:12,vars:1,consts:[[1,"container","mx-auto","px-0","lg:px-6"],[1,"mt-20","lg:mt-24","px-4","lg:px-8"],[1,"flex","justify-between","items-start"],[1,"flex","space-x-2"],["id","writeStoryBtn",1,"pointer","px-6","py-2","rounded-full","font-medium","bg-wattpad-secondary","text-white","hover:bg-[#009966]","transition-colors",3,"click"],[1,"py-4"],["id","stories-tab",1,"tab-content","active"],[1,"grid","grid-cols-1","gap-4"],["class","pointer bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm hover:shadow-md transition-all",3,"click",4,"ngFor","ngForOf"],[1,"pointer","bg-white","dark:bg-gray-800","rounded-lg","p-4","shadow-sm","hover:shadow-md","transition-all",3,"click"],[1,"flex","space-x-4"],[1,"bg-gray-200","w-20","h-28","lg:w-24","lg:h-32","rounded-lg","flex-shrink-0","flex","items-center","justify-center"],[1,"text-gray-500","text-xs"],[1,"flex-1","min-w-0"],[1,"font-bold","text-lg","lg:text-xl"],[3,"ngClass"],[1,"flex","items-center","mt-2","text-sm","lg:text-base"],[1,"fas","fa-star","text-yellow-400","mr-1"],[1,"text-sm","lg:text-base","mt-2","line-clamp-2"],[1,"flex","justify-between","items-center","mt-3"],[1,"text-xs","lg:text-sm","text-wattpad-light"],[1,"pointer","text-xs","lg:text-sm","bg-wattpad-primary","text-white","px-3","py-1","rounded-full","hover:bg-[#E5274B]","transition-colors",3,"click"],["class","text-sm text-green-700 bg-green-100 border border-green-300 rounded px-4 py-2 mb-3",4,"ngIf"],[1,"text-sm","text-green-700","bg-green-100","border","border-green-300","rounded","px-4","py-2","mb-3"]],template:function(e,i){e&1&&(u(0,"app-header"),s(1,"main",0)(2,"div",1)(3,"div",2),u(4,"div"),s(5,"div",3)(6,"button",4),h("click",function(){return i.goToCreate()}),o(7," Write New episode "),n()()(),s(8,"div",5)(9,"div",6)(10,"div",7),v(11,N,22,8,"div",8),n()()()()()),e&2&&(a(11),g("ngForOf",i.stories))},dependencies:[F,S,I,C,E]})}}return r})();export{R as EpisodeComponent};
